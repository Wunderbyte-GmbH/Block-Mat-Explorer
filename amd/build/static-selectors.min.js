define("block_mat_explorer/static-selectors",["exports","./templates","core/str"],(function(_exports,_templates,_str){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.updateMainContainer=_exports.updateFilterState=_exports.updateCourseCount=_exports.setInstanceId=_exports.prepareSortDropdown=_exports.prepareDropDowns=_exports.initiateSearch=_exports.initDropDownData=_exports.getFiltersFromTargets=_exports.getFilterState=_exports.getElement=_exports.SORT_TYPES=_exports.SELECTORS=_exports.FILTER_TYPES=_exports.FIELD_FILTER_MAP=void 0;let dropDownData=null,instanceRoot="";_exports.setInstanceId=id=>{instanceRoot=document.getElementById("id-"+id)};const FILTER_TYPES={QUERY:"QUERY",CATEGORY:"CATEGORY",TOPICS:"TOPICS",TARGET_GROUP:"TARGET_GROUP",CURRENT_PAGE:"CURRENT_PAGE",ORDER:"ORDER"};_exports.FILTER_TYPES=FILTER_TYPES;const FIELD_FILTER_MAP={category:"CATEGORY",mc_moodle_themen:"TOPICS",mc_moodle_zielgruppe:"TARGET_GROUP"};_exports.FIELD_FILTER_MAP=FIELD_FILTER_MAP;const SORT_TYPES={alphabetASC:{field:"title",direction:1,name:"Alphabetisch aufsteigend"},alphabetDESC:{field:"title",direction:-1,name:"Alphabetisch absteigend"},mcOriginalDESC:{field:"MCOriginal",direction:-1,name:"MINT-Campus-Original zuerst"},favouritesDESC:{field:"favourite",direction:-1,name:"Favoriten zuerst"}};_exports.SORT_TYPES=SORT_TYPES,(0,_str.get_string)("sortalphabetasc","block_course_explorer").then((string=>(SORT_TYPES.alphabetASC.name=string,string))).catch(),(0,_str.get_string)("sortalphabetdesc","block_course_explorer").then((string=>(SORT_TYPES.alphabetDESC.name=string,string))).catch(),(0,_str.get_string)("sortmcoriginaldesc","block_course_explorer").then((string=>(SORT_TYPES.mcOriginalDESC.name=string,string))).catch(),(0,_str.get_string)("sortfavouritesdesc","block_course_explorer").then((string=>(SORT_TYPES.favouritesDESC.name=string,string))).catch();const SELECTORS={MAIN_WRAPPER:"matMainWrapper",MAIN_CONTAINER:"matMainContainer",DROPDOWN_CONTAINER:"matDropDownContainer",LOADING_CONTAINER:"matLoadingContainer",SEARCH_INPUT:"matSearchInput",SEARCH_CLEAR_BUTTON:"matClearSearch",COURSE_COUNT:"matCourseCount",TOP_PAGINATION_CONTAINER:"matTopPaginationContainer",BOTTOM_PAGINATION_CONTAINER:"matBottomPaginationContainer",SORT_DROPDOWN_CONTAINER:"matSortContainer",COURSE_DETAIL_MODAL:"mat_modal"};_exports.SELECTORS=SELECTORS;let filterState={QUERY:null,CURRENT_PAGE:0,PAGE_SIZE:12,ORDER:null};for(const key in FIELD_FILTER_MAP)filterState[FIELD_FILTER_MAP[key]]=null;_exports.getFilterState=()=>filterState;const updateFilterState=(type,param)=>{if(null===param)return!1;return filterState[type]!==param&&(filterState.CURRENT_PAGE=0,filterState[type]=param,!0)};_exports.updateFilterState=updateFilterState;const resetFilterStateByType=type=>null!==filterState[type]&&(filterState[type]=null,!0),getElement=selector=>instanceRoot?(console.log(instanceRoot),instanceRoot.querySelector(`#${selector}`)):(console.warn("No instance root set. Call setInstanceId(id) first."),null);_exports.getElement=getElement;_exports.initDropDownData=data=>{dropDownData=data};const prepareDropDowns=async function(handleFilter,activeFilters,triggeredFilter){let reset=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const dropdownContainer=getElement(SELECTORS.DROPDOWN_CONTAINER),dropDowns=[];let caption="";for(let i=0;i<dropDownData.length;i++){var _defaultOption;let filter=dropDownData[i];const selectedOption=filterState[FIELD_FILTER_MAP[filter.name]];let defaultOption=null;null!==selectedOption&&(defaultOption=filter.options.find((option=>option.id==selectedOption))||null);const options=filter.options;if(activeFilters&&triggeredFilter){const activeFilter=activeFilters.find((activeFilter=>activeFilter.name===filter.name));options.forEach((option=>{if(filter.name===triggeredFilter&&!reset)return;const match=activeFilter.options.find((filterOption=>filterOption.name===option.name));option.disabled=void 0===match}))}caption=await(0,_str.get_string)(FIELD_FILTER_MAP[filter.name].toLowerCase()+"filtercaption","block_course_explorer");const dropDown=(0,_templates.dropDownTemplate)({title:caption,caption:(null===(_defaultOption=defaultOption)||void 0===_defaultOption?void 0:_defaultOption.name)||caption,options:options,selectedOption:defaultOption,onOptionChange:optionId=>{if(updateFilterState(FIELD_FILTER_MAP[filter.name],optionId)){const filteredCourses=handleFilter(),filters=getFiltersFromTargets(filteredCourses),triggeredFilter=filter.name;prepareDropDowns(handleFilter,filters,triggeredFilter)}},onReset:()=>{if(resetFilterStateByType(FIELD_FILTER_MAP[filter.name])){const filteredCourses=handleFilter(),filters=getFiltersFromTargets(filteredCourses),triggeredFilter=filter.name;prepareDropDowns(handleFilter,filters,triggeredFilter,!0)}},className:"mat-dropdown-"+filter.name.toLowerCase()});dropDowns.push(dropDown)}$(dropdownContainer).empty(),dropDowns.forEach((function(dropDown){$(dropdownContainer).append(dropDown)}))};_exports.prepareDropDowns=prepareDropDowns;_exports.updateMainContainer=elements=>{const mainContainer=getElement(SELECTORS.MAIN_CONTAINER);$(mainContainer).empty(),$(mainContainer).append(elements)};_exports.initiateSearch=handleFilter=>{const searchInput=getElement(SELECTORS.SEARCH_INPUT),searchClearButton=getElement(SELECTORS.SEARCH_CLEAR_BUTTON);searchInput.addEventListener("keyup",(e=>{updateFilterState(FILTER_TYPES.QUERY,e.target.value)&&handleFilter(filterState)})),searchClearButton.addEventListener("click",(()=>{searchInput.value="",updateFilterState(FILTER_TYPES.QUERY,"")&&handleFilter(filterState)}))};_exports.updateCourseCount=async count=>{const courseCount=getElement(SELECTORS.COURSE_COUNT),caption=await(0,_str.get_string)(1!==count?"coursecountcaption":"coursecountonecaption","block_course_explorer");courseCount.innerHTML=`${count||"0"} ${caption}`};const prepareSortDropdown=async handleFilter=>{var _defaultOption2;const sortDropdownContainer=getElement(SELECTORS.SORT_DROPDOWN_CONTAINER),sortOptions=[];for(const key in SORT_TYPES)sortOptions.push({id:key,name:SORT_TYPES[key].name});const selectedOption=filterState.ORDER;let defaultOption=null;null!==selectedOption&&(defaultOption=sortOptions.find((option=>option.id==selectedOption))||null);const caption=await(0,_str.get_string)("sortcaption","block_course_explorer"),sortDropDown=await(0,_templates.dropDownTemplate)({title:caption,caption:(null===(_defaultOption2=defaultOption)||void 0===_defaultOption2?void 0:_defaultOption2.name)||caption,options:sortOptions,selectedOption:defaultOption,onOptionChange:optionId=>{updateFilterState(FILTER_TYPES.ORDER,optionId)&&(handleFilter(),prepareSortDropdown(handleFilter))},onReset:()=>{resetFilterStateByType(FILTER_TYPES.ORDER)&&(handleFilter(),prepareSortDropdown(handleFilter))}});$(sortDropdownContainer).empty(),$(sortDropdownContainer).append(sortDropDown)};_exports.prepareSortDropdown=prepareSortDropdown;const getFiltersFromTargets=targets=>{const keys=[];for(const key in FIELD_FILTER_MAP)keys.push(key);const filters=(keys=>{const filters=[];return keys.forEach((key=>{filters.push({name:key,options:[]})})),filters})(keys);return filters.forEach((filter=>{filter.options=((key,targets)=>{let filterOptions=[];const optionsCount={};targets.forEach((target=>{void 0!==target[key]&&null!==target[key]&&""!==target[key]&&(Array.isArray(target[key])?target[key].forEach((item=>{optionsCount[item.id]?optionsCount[item.id].count++:optionsCount[item.id]={count:1,value:item.value}})):optionsCount[target[key].id]?optionsCount[target[key].id].count++:optionsCount[target[key].id]={count:1,value:target[key].value})}));for(const option in optionsCount)filterOptions.push({id:option,name:optionsCount[option].value,count:optionsCount[option].count});return filterOptions.sort(((a,b)=>a.name<b.name?-1:a.name>b.name?1:0))})(filter.name,targets)})),filters};_exports.getFiltersFromTargets=getFiltersFromTargets}));

//# sourceMappingURL=static-selectors.min.js.map