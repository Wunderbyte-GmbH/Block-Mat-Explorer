{"version":3,"file":"static-selectors.min.js","sources":["../src/static-selectors.js"],"sourcesContent":["import {dropDownTemplate} from \"./templates\";\nimport {get_string as getString} from 'core/str';\n\nlet dropDownData = null;\nlet instanceRoot = \"\";\n\nexport const setInstanceId = (id) => {\n  instanceRoot = document.getElementById('id-' + id);\n};\n\n\nexport const FILTER_TYPES = {\n  QUERY: \"QUERY\",\n  CATEGORY: \"CATEGORY\",\n  TOPICS: \"TOPICS\",\n  TARGET_GROUP: \"TARGET_GROUP\",\n  CURRENT_PAGE: \"CURRENT_PAGE\",\n  ORDER: \"ORDER\",\n};\nexport const FIELD_FILTER_MAP = {\n  category: \"CATEGORY\",\n  mc_moodle_themen: \"TOPICS\",\n  mc_moodle_zielgruppe: \"TARGET_GROUP\"\n};\nexport const SORT_TYPES = {\n  alphabetASC: {\n    field: \"title\",\n    direction: 1,\n    name: 'Alphabetisch aufsteigend'\n  },\n  alphabetDESC: {\n    field: \"title\",\n    direction: -1,\n    name: 'Alphabetisch absteigend'\n  },\n  mcOriginalDESC: {\n    field: \"MCOriginal\",\n    direction: -1,\n    name: 'MINT-Campus-Original zuerst'\n  },\n  favouritesDESC: {\n    field: \"favourite\",\n    direction: -1,\n    name: 'Favoriten zuerst'\n  }\n};\ngetString('sortalphabetasc', 'block_course_explorer').then((string) => {\n  SORT_TYPES.alphabetASC.name = string;\n  return string;\n}).catch();\ngetString('sortalphabetdesc', 'block_course_explorer').then((string) => {\n  SORT_TYPES.alphabetDESC.name = string;\n  return string;\n}).catch();\ngetString('sortmcoriginaldesc', 'block_course_explorer').then((string) => {\n  SORT_TYPES.mcOriginalDESC.name = string;\n  return string;\n}).catch();\ngetString('sortfavouritesdesc', 'block_course_explorer').then((string) => {\n  SORT_TYPES.favouritesDESC.name = string;\n  return string;\n}).catch();\n\nexport const SELECTORS = {\n  MAIN_WRAPPER: \"matMainWrapper\",\n  MAIN_CONTAINER: \"matMainContainer\",\n  DROPDOWN_CONTAINER: \"matDropDownContainer\",\n  LOADING_CONTAINER: \"matLoadingContainer\",\n  SEARCH_INPUT: \"matSearchInput\",\n  SEARCH_CLEAR_BUTTON: \"matClearSearch\",\n  COURSE_COUNT: \"matCourseCount\",\n  TOP_PAGINATION_CONTAINER: \"matTopPaginationContainer\",\n  BOTTOM_PAGINATION_CONTAINER: \"matBottomPaginationContainer\",\n  SORT_DROPDOWN_CONTAINER: \"matSortContainer\",\n  COURSE_DETAIL_MODAL: \"mat_modal\",\n};\n\nlet filterState = {\n  QUERY: null,\n  CURRENT_PAGE: 0,\n  PAGE_SIZE: 12,\n  ORDER: null,\n};\nfor (const key in FIELD_FILTER_MAP) {\n  filterState[FIELD_FILTER_MAP[key]] = null;\n}\n\nexport const getFilterState = () => {\n  return filterState;\n};\n\nexport const updateFilterState = (type, param) => {\n  if (param === null) {\n    return false;\n  }\n  const state = filterState[type];\n  if (state !== param) {\n    filterState.CURRENT_PAGE = 0;\n    filterState[type] = param;\n    return true;\n  }\n  return false;\n};\n\nconst resetFilterStateByType = (type) => {\n  if (filterState[type] === null) {\n    return false;\n  }\n  filterState[type] = null;\n  return true;\n};\n\nexport const getElement = (selector) => {\n  if (!instanceRoot) {\n    console.warn(\"No instance root set. Call setInstanceId(id) first.\");\n    return null;\n  }\n  console.log(instanceRoot);\n  return instanceRoot.querySelector(`#${selector}`);\n};\n\nexport const initDropDownData = (data) => {\n  dropDownData = data;\n};\n\nexport const prepareDropDowns = async(handleFilter, activeFilters, triggeredFilter, reset = false) => {\n  const dropdownContainer = getElement(SELECTORS.DROPDOWN_CONTAINER);\n  const dropDowns = [];\n  let caption = '';\n  for (let i = 0; i < dropDownData.length; i++) {\n    let filter = dropDownData[i];\n    const selectedOption = filterState[FIELD_FILTER_MAP[filter.name]];\n    let defaultOption = null;\n    if (selectedOption !== null) {\n      defaultOption = filter.options.find((option) => option.id == selectedOption) || null;\n    }\n\n    const options = filter.options;\n    if (activeFilters && triggeredFilter) {\n      const activeFilter = activeFilters.find((activeFilter) => activeFilter.name === filter.name);\n      options.forEach((option) => {\n        if (filter.name === triggeredFilter && !reset) {\n          return;\n        }\n        const match = activeFilter.options.find(filterOption => filterOption.name === option.name);\n        option.disabled = match === undefined;\n      });\n    }\n\n    caption = await getString(FIELD_FILTER_MAP[filter.name].toLowerCase() + 'filtercaption', 'block_course_explorer');\n    const dropDown = dropDownTemplate({\n      title: caption,\n      caption: defaultOption?.name || caption,\n      options: options,\n      selectedOption: defaultOption,\n      onOptionChange: (optionId) => {\n        if (updateFilterState(FIELD_FILTER_MAP[filter.name], optionId)) {\n          const filteredCourses = handleFilter();\n          const filters = getFiltersFromTargets(filteredCourses);\n          const triggeredFilter = filter.name;\n          prepareDropDowns(handleFilter, filters, triggeredFilter);\n        }\n      },\n      onReset: () => {\n        if (resetFilterStateByType(FIELD_FILTER_MAP[filter.name])) {\n          const filteredCourses = handleFilter();\n          const filters = getFiltersFromTargets(filteredCourses);\n          const triggeredFilter = filter.name;\n          prepareDropDowns(handleFilter, filters, triggeredFilter, true);\n        }\n      },\n      className: \"mat-dropdown-\" + filter.name.toLowerCase(),\n    });\n    dropDowns.push(dropDown);\n  }\n\n  $(dropdownContainer).empty();\n  dropDowns.forEach(function(dropDown) {\n    $(dropdownContainer).append(dropDown);\n  });\n};\n\nexport const updateMainContainer = (elements) => {\n  const mainContainer = getElement(SELECTORS.MAIN_CONTAINER);\n  $(mainContainer).empty();\n  $(mainContainer).append(elements);\n};\n\nexport const initiateSearch = (handleFilter) => {\n  const searchInput = getElement(SELECTORS.SEARCH_INPUT);\n  const searchClearButton = getElement(SELECTORS.SEARCH_CLEAR_BUTTON);\n\n  searchInput.addEventListener(\"keyup\", (e) => {\n    if (updateFilterState(FILTER_TYPES.QUERY, e.target.value)) {\n      handleFilter(filterState);\n    }\n  });\n\n  searchClearButton.addEventListener(\"click\", () => {\n    searchInput.value = \"\";\n    if (updateFilterState(FILTER_TYPES.QUERY, \"\")) {\n      handleFilter(filterState);\n    }\n  });\n};\n\nexport const updateCourseCount = async(count) => {\n  const courseCount = getElement(SELECTORS.COURSE_COUNT);\n  const caption = await getString(count !== 1 ? 'coursecountcaption' : 'coursecountonecaption', 'block_course_explorer');\n  courseCount.innerHTML = `${count || \"0\"} ${caption}`;\n};\n\nexport const prepareSortDropdown = async(handleFilter) => {\n  const sortDropdownContainer = getElement(SELECTORS.SORT_DROPDOWN_CONTAINER);\n  const sortOptions = [];\n\n  for (const key in SORT_TYPES) {\n    sortOptions.push({\n      id: key, // TODO: rename in key\n      name: SORT_TYPES[key].name // TODO: rename in value and description\n    });\n  }\n\n  const selectedOption = filterState.ORDER;\n  let defaultOption = null;\n  if (selectedOption !== null) {\n    defaultOption = sortOptions.find((option) => option.id == selectedOption) || null;\n  }\n\n  const caption = await getString('sortcaption', 'block_course_explorer');\n  const sortDropDown = await dropDownTemplate({\n    title: caption,\n    caption: defaultOption?.name || caption,\n    options: sortOptions,\n    selectedOption: defaultOption,\n    onOptionChange: (optionId) => {\n      if (updateFilterState(FILTER_TYPES.ORDER, optionId)) {\n        handleFilter();\n        prepareSortDropdown(handleFilter);\n      }\n    },\n    onReset: () => {\n      if (resetFilterStateByType(FILTER_TYPES.ORDER)) {\n        handleFilter();\n        prepareSortDropdown(handleFilter);\n      }\n    }\n  });\n  $(sortDropdownContainer).empty();\n  $(sortDropdownContainer).append(sortDropDown);\n};\n\n\nconst getEmptyFilters = (keys) => {\n  const filters = [];\n  keys.forEach((key) => {\n    filters.push({\n      name: key,\n      options: []\n    });\n  });\n  return filters;\n};\n\nconst getFilterOptionsFromTargetsByKey = (key, targets) => {\n  let filterOptions = [];\n  const optionsCount = {};\n  targets.forEach((target) => {\n    if (target[key] === undefined || target[key] === null || target[key] === '') {\n      return;\n    }\n    if (Array.isArray(target[key])) {\n      target[key].forEach((item) => {\n        if (optionsCount[item.id]) {\n          optionsCount[item.id].count++;\n        } else {\n          optionsCount[item.id] = {\n            count: 1,\n            value: item.value\n          };\n        }\n      });\n    } else {\n      if (optionsCount[target[key].id]) {\n        optionsCount[target[key].id].count++;\n      } else {\n        optionsCount[target[key].id] = {\n          count: 1,\n          value: target[key].value\n        };\n      }\n    }\n  });\n  for (const option in optionsCount) {\n    filterOptions.push({\n      id: option,\n      name: optionsCount[option].value,\n      count: optionsCount[option].count\n    });\n  }\n\n  return filterOptions.sort((a, b) => {\n    if (a.name < b.name) {\n      return -1;\n    } else if (a.name > b.name) {\n      return 1;\n    } else {\n      return 0;\n    }\n  });\n};\n\nexport const getFiltersFromTargets = (targets) => {\n  const keys = [];\n  for (const key in FIELD_FILTER_MAP) {\n    keys.push(key);\n  }\n  const filters = getEmptyFilters(keys);\n\n  filters.forEach((filter) => {\n    filter.options = getFilterOptionsFromTargetsByKey(filter.name, targets);\n  });\n\n  return filters;\n};"],"names":["dropDownData","instanceRoot","id","document","getElementById","FILTER_TYPES","QUERY","CATEGORY","TOPICS","TARGET_GROUP","CURRENT_PAGE","ORDER","FIELD_FILTER_MAP","category","mc_moodle_themen","mc_moodle_zielgruppe","SORT_TYPES","alphabetASC","field","direction","name","alphabetDESC","mcOriginalDESC","favouritesDESC","then","string","catch","SELECTORS","MAIN_WRAPPER","MAIN_CONTAINER","DROPDOWN_CONTAINER","LOADING_CONTAINER","SEARCH_INPUT","SEARCH_CLEAR_BUTTON","COURSE_COUNT","TOP_PAGINATION_CONTAINER","BOTTOM_PAGINATION_CONTAINER","SORT_DROPDOWN_CONTAINER","COURSE_DETAIL_MODAL","filterState","PAGE_SIZE","key","updateFilterState","type","param","resetFilterStateByType","getElement","selector","console","log","querySelector","warn","data","prepareDropDowns","async","handleFilter","activeFilters","triggeredFilter","reset","dropdownContainer","dropDowns","caption","i","length","filter","selectedOption","defaultOption","options","find","option","activeFilter","forEach","match","filterOption","disabled","undefined","toLowerCase","dropDown","title","onOptionChange","optionId","filteredCourses","filters","getFiltersFromTargets","onReset","className","push","$","empty","append","elements","mainContainer","searchInput","searchClearButton","addEventListener","e","target","value","courseCount","count","innerHTML","prepareSortDropdown","sortDropdownContainer","sortOptions","sortDropDown","targets","keys","getEmptyFilters","filterOptions","optionsCount","Array","isArray","item","sort","a","b","getFilterOptionsFromTargetsByKey"],"mappings":"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"}